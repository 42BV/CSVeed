<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>NumberUtils.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">CSVeed</a> &gt; <a href="index.source.html" class="el_package">org.csveed.bean.conversion</a> &gt; <span class="el_source">NumberUtils.java</span></div><h1>NumberUtils.java</h1><pre class="source lang-java linenums">package org.csveed.bean.conversion;

import static org.csveed.bean.conversion.ConversionUtil.trimAllWhitespace;

import java.math.BigDecimal;
import java.math.BigInteger;
import java.text.DecimalFormat;
import java.text.NumberFormat;
import java.text.ParseException;

<span class="nc" id="L11">public abstract class NumberUtils {</span>

    @SuppressWarnings(&quot;unchecked&quot;)
    public static &lt;T extends Number&gt; T convertNumberToTargetClass(Number number, Class&lt;T&gt; targetClass)
            throws IllegalArgumentException {

<span class="fc bfc" id="L17" title="All 2 branches covered.">        if (targetClass.isInstance(number)) {</span>
<span class="fc" id="L18">            return (T) number;</span>
<span class="fc bfc" id="L19" title="All 2 branches covered.">        } else if (targetClass.equals(Byte.class)) {</span>
<span class="fc" id="L20">            long value = number.longValue();</span>
<span class="pc bpc" id="L21" title="2 of 4 branches missed.">            if (value &lt; Byte.MIN_VALUE || value &gt; Byte.MAX_VALUE) {</span>
<span class="nc" id="L22">                raiseOverflowException(number, targetClass);</span>
            }
<span class="fc" id="L24">            return (T) Byte.valueOf(number.byteValue());</span>
<span class="fc bfc" id="L25" title="All 2 branches covered.">        } else if (targetClass.equals(Short.class)) {</span>
<span class="fc" id="L26">            long value = number.longValue();</span>
<span class="pc bpc" id="L27" title="2 of 4 branches missed.">            if (value &lt; Short.MIN_VALUE || value &gt; Short.MAX_VALUE) {</span>
<span class="nc" id="L28">                raiseOverflowException(number, targetClass);</span>
            }
<span class="fc" id="L30">            return (T) Short.valueOf(number.shortValue());</span>
<span class="fc bfc" id="L31" title="All 2 branches covered.">        } else if (targetClass.equals(Integer.class)) {</span>
<span class="fc" id="L32">            long value = number.longValue();</span>
<span class="pc bpc" id="L33" title="2 of 4 branches missed.">            if (value &lt; Integer.MIN_VALUE || value &gt; Integer.MAX_VALUE) {</span>
<span class="nc" id="L34">                raiseOverflowException(number, targetClass);</span>
            }
<span class="fc" id="L36">            return (T) Integer.valueOf(number.intValue());</span>
<span class="pc bpc" id="L37" title="1 of 2 branches missed.">        } else if (targetClass.equals(Long.class)) {</span>
<span class="nc" id="L38">            return (T) Long.valueOf(number.longValue());</span>
<span class="pc bpc" id="L39" title="1 of 2 branches missed.">        } else if (targetClass.equals(BigInteger.class)) {</span>
<span class="nc bnc" id="L40" title="All 2 branches missed.">            if (number instanceof BigDecimal) {</span>
                // do not lose precision - use BigDecimal's own conversion
<span class="nc" id="L42">                return (T) ((BigDecimal) number).toBigInteger();</span>
            }
            // original value is not a Big* number - use standard long conversion
<span class="nc" id="L45">            return (T) BigInteger.valueOf(number.longValue());</span>
<span class="pc bpc" id="L46" title="1 of 2 branches missed.">        } else if (targetClass.equals(Float.class)) {</span>
<span class="fc" id="L47">            return (T) Float.valueOf(number.floatValue());</span>
<span class="nc bnc" id="L48" title="All 2 branches missed.">        } else if (targetClass.equals(Double.class)) {</span>
<span class="nc" id="L49">            return (T) Double.valueOf(number.doubleValue());</span>
<span class="nc bnc" id="L50" title="All 2 branches missed.">        } else if (targetClass.equals(BigDecimal.class)) {</span>
            // always use BigDecimal(String) here to avoid unpredictability of BigDecimal(double)
            // (see BigDecimal javadoc for details)
<span class="nc" id="L53">            return (T) new BigDecimal(number.toString());</span>
        } else {
<span class="nc" id="L55">            throw new IllegalArgumentException(&quot;Could not convert number [&quot; + number + &quot;] of type [&quot; +</span>
<span class="nc" id="L56">                    number.getClass().getName() + &quot;] to unknown target class [&quot; + targetClass.getName() + &quot;]&quot;);</span>
        }
    }

    private static void raiseOverflowException(Number number, Class targetClass) {
<span class="nc" id="L61">        throw new IllegalArgumentException(&quot;Could not convert number [&quot; + number + &quot;] of type [&quot; +</span>
<span class="nc" id="L62">                number.getClass().getName() + &quot;] to target class [&quot; + targetClass.getName() + &quot;]: overflow&quot;);</span>
    }

    @SuppressWarnings(&quot;unchecked&quot;)
    public static &lt;T extends Number&gt; T parseNumber(String text, Class&lt;T&gt; targetClass) {
<span class="fc" id="L67">        String trimmed = trimAllWhitespace(text);</span>

<span class="pc bpc" id="L69" title="1 of 2 branches missed.">        if (targetClass.equals(Byte.class)) {</span>
<span class="nc bnc" id="L70" title="All 2 branches missed.">            return (T) (isHexNumber(trimmed) ? Byte.decode(trimmed) : Byte.valueOf(trimmed));</span>
<span class="pc bpc" id="L71" title="1 of 2 branches missed.">        } else if (targetClass.equals(Short.class)) {</span>
<span class="nc bnc" id="L72" title="All 2 branches missed.">            return (T) (isHexNumber(trimmed) ? Short.decode(trimmed) : Short.valueOf(trimmed));</span>
<span class="pc bpc" id="L73" title="1 of 2 branches missed.">        } else if (targetClass.equals(Integer.class)) {</span>
<span class="nc bnc" id="L74" title="All 2 branches missed.">            return (T) (isHexNumber(trimmed) ? Integer.decode(trimmed) : Integer.valueOf(trimmed));</span>
<span class="pc bpc" id="L75" title="1 of 2 branches missed.">        } else if (targetClass.equals(Long.class)) {</span>
<span class="nc bnc" id="L76" title="All 2 branches missed.">            return (T) (isHexNumber(trimmed) ? Long.decode(trimmed) : Long.valueOf(trimmed));</span>
<span class="pc bpc" id="L77" title="1 of 2 branches missed.">        } else if (targetClass.equals(BigInteger.class)) {</span>
<span class="pc bpc" id="L78" title="1 of 2 branches missed.">            return (T) (isHexNumber(trimmed) ? decodeBigInteger(trimmed) : new BigInteger(trimmed));</span>
<span class="nc bnc" id="L79" title="All 2 branches missed.">        } else if (targetClass.equals(Float.class)) {</span>
<span class="nc" id="L80">            return (T) Float.valueOf(trimmed);</span>
<span class="nc bnc" id="L81" title="All 2 branches missed.">        } else if (targetClass.equals(Double.class)) {</span>
<span class="nc" id="L82">            return (T) Double.valueOf(trimmed);</span>
<span class="nc bnc" id="L83" title="All 4 branches missed.">        } else if (targetClass.equals(BigDecimal.class) || targetClass.equals(Number.class)) {</span>
<span class="nc" id="L84">            return (T) new BigDecimal(trimmed);</span>
        } else {
<span class="nc" id="L86">            throw new IllegalArgumentException(</span>
<span class="nc" id="L87">                    &quot;Cannot convert String [&quot; + text + &quot;] to target class [&quot; + targetClass.getName() + &quot;]&quot;);</span>
        }
    }

    public static &lt;T extends Number&gt; T parseNumber(String text, Class&lt;T&gt; targetClass, NumberFormat numberFormat) {
<span class="pc bpc" id="L92" title="1 of 2 branches missed.">        if (numberFormat != null) {</span>
<span class="fc" id="L93">            DecimalFormat decimalFormat = null;</span>
<span class="fc" id="L94">            boolean resetBigDecimal = false;</span>
<span class="pc bpc" id="L95" title="1 of 2 branches missed.">            if (numberFormat instanceof DecimalFormat) {</span>
<span class="fc" id="L96">                decimalFormat = (DecimalFormat) numberFormat;</span>
<span class="pc bpc" id="L97" title="1 of 4 branches missed.">                if (BigDecimal.class.equals(targetClass) &amp;&amp; !decimalFormat.isParseBigDecimal()) {</span>
<span class="fc" id="L98">                    decimalFormat.setParseBigDecimal(true);</span>
<span class="fc" id="L99">                    resetBigDecimal = true;</span>
                }
            }
            try {
<span class="fc" id="L103">                Number number = numberFormat.parse(trimAllWhitespace(text));</span>
<span class="fc" id="L104">                return convertNumberToTargetClass(number, targetClass);</span>
<span class="fc" id="L105">            } catch (ParseException ex) {</span>
<span class="fc" id="L106">                throw new IllegalArgumentException(&quot;Could not parse number: &quot; + ex.getMessage());</span>
            } finally {
<span class="pc bpc" id="L108" title="1 of 4 branches missed.">                if (resetBigDecimal &amp;&amp; decimalFormat != null) {</span>
<span class="fc" id="L109">                    decimalFormat.setParseBigDecimal(false);</span>
                }
            }
        }
<span class="nc" id="L113">        return parseNumber(text, targetClass);</span>
    }

    private static boolean isHexNumber(String value) {
<span class="pc bpc" id="L117" title="1 of 2 branches missed.">        int index = value.startsWith(&quot;-&quot;) ? 1 : 0;</span>
<span class="pc bpc" id="L118" title="3 of 6 branches missed.">        return value.startsWith(&quot;0x&quot;, index) || value.startsWith(&quot;0X&quot;, index) || value.startsWith(&quot;#&quot;, index);</span>
    }

    private static BigInteger decodeBigInteger(String value) {
<span class="nc" id="L122">        int radix = 10;</span>
<span class="nc" id="L123">        int index = 0;</span>
<span class="nc" id="L124">        boolean negative = false;</span>

        // Handle minus sign, if present.
<span class="nc bnc" id="L127" title="All 2 branches missed.">        if (value.startsWith(&quot;-&quot;)) {</span>
<span class="nc" id="L128">            negative = true;</span>
<span class="nc" id="L129">            index++;</span>
        }

        // Handle radix specifier, if present.
<span class="nc bnc" id="L133" title="All 4 branches missed.">        if (value.startsWith(&quot;0x&quot;, index) || value.startsWith(&quot;0X&quot;, index)) {</span>
<span class="nc" id="L134">            index += 2;</span>
<span class="nc" id="L135">            radix = 16;</span>
<span class="nc bnc" id="L136" title="All 2 branches missed.">        } else if (value.startsWith(&quot;#&quot;, index)) {</span>
<span class="nc" id="L137">            index++;</span>
<span class="nc" id="L138">            radix = 16;</span>
<span class="nc bnc" id="L139" title="All 4 branches missed.">        } else if (value.startsWith(&quot;0&quot;, index) &amp;&amp; value.length() &gt; 1 + index) {</span>
<span class="nc" id="L140">            index++;</span>
<span class="nc" id="L141">            radix = 8;</span>
        }

<span class="nc" id="L144">        BigInteger result = new BigInteger(value.substring(index), radix);</span>
<span class="nc bnc" id="L145" title="All 2 branches missed.">        return negative ? result.negate() : result;</span>
    }

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>